{"ast":null,"code":"import _defineProperty from \"/Users/admin/Documents/personal-site/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"/Users/admin/Documents/personal-site/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"/Users/admin/Documents/personal-site/node_modules/next/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\n\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\nimport { getType } from \"deox\";\nimport { uiActions } from \"../../actions\";\nimport Cookies from \"js-cookie\";\n\nvar getErrorMatches = function getErrorMatches(actionType) {\n  return /(.*)_(REQUEST|FAILED)/.exec(actionType);\n};\n\nvar errorReducer = function errorReducer() {\n  var _payload;\n\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  if (action.type === getType(uiActions.resetActionStatus)) {\n    var actionName = action.payload.actionName;\n\n    var _ = state[actionName],\n        newState = _objectWithoutProperties(state, [actionName].map(_toPropertyKey));\n\n    return newState;\n  }\n\n  var matches = getErrorMatches(action.type);\n\n  if (!matches) {\n    return state;\n  }\n\n  var _matches = _slicedToArray(matches, 3),\n      requestName = _matches[1],\n      requestState = _matches[2];\n\n  var error = (_payload = action.payload) === null || _payload === void 0 ? void 0 : _payload.error;\n\n  if (error instanceof Error) {\n    var _error, _error$response, _axiosErrorData$error;\n\n    var axiosErrorData = (_error = error) === null || _error === void 0 ? void 0 : (_error$response = _error.response) === null || _error$response === void 0 ? void 0 : _error$response.data;\n    error = (axiosErrorData === null || axiosErrorData === void 0 ? void 0 : axiosErrorData.message) || (axiosErrorData === null || axiosErrorData === void 0 ? void 0 : axiosErrorData.error_description) || (axiosErrorData === null || axiosErrorData === void 0 ? void 0 : (_axiosErrorData$error = axiosErrorData.errors) === null || _axiosErrorData$error === void 0 ? void 0 : _axiosErrorData$error[0].message) || error.message;\n\n    if ((axiosErrorData === null || axiosErrorData === void 0 ? void 0 : axiosErrorData.statusCode) === 401) {\n      localStorage.removeItem(\"accounts\");\n      Cookies.remove(\"crm_token\");\n      Cookies.remove(\"isAuthenticated\");\n      window.location.reload();\n    }\n  }\n\n  return _objectSpread(_objectSpread({}, state), {}, _defineProperty({}, requestName, requestState === \"FAILED\" && error ? error : null));\n};\n\nexport default errorReducer;","map":{"version":3,"sources":["/Users/admin/Documents/personal-site/src/state-management/reducers/status/error.ts"],"names":["getType","uiActions","Cookies","getErrorMatches","actionType","exec","errorReducer","state","action","type","resetActionStatus","actionName","payload","_","newState","matches","requestName","requestState","error","Error","axiosErrorData","response","data","message","error_description","errors","statusCode","localStorage","removeItem","remove","window","location","reload"],"mappings":";;;;;;;;;;;;AAAA,SAASA,OAAT,QAAwB,MAAxB;AAGA,SAASC,SAAT,QAA0B,eAA1B;AACA,OAAOC,OAAP,MAAoB,WAApB;;AAoBA,IAAMC,eAAe,GAAG,SAAlBA,eAAkB,CAACC,UAAD;AAAA,SACtB,wBAAwBC,IAAxB,CAA6BD,UAA7B,CADsB;AAAA,CAAxB;;AAGA,IAAME,YAAY,GAAG,SAAfA,YAAe,GAGH;AAAA;;AAAA,MAFhBC,KAEgB,uEAFK,EAEL;AAAA,MADhBC,MACgB;;AAChB,MAAIA,MAAM,CAACC,IAAP,KAAgBT,OAAO,CAACC,SAAS,CAACS,iBAAX,CAA3B,EAA0D;AAAA,QAChDC,UADgD,GAChCH,MAAD,CAAyBI,OADQ,CAChDD,UADgD;;AAAA,QAElCE,CAFkC,GAEfN,KAFe,CAE/CI,UAF+C;AAAA,QAE5BG,QAF4B,4BAEfP,KAFe,GAE/CI,UAF+C;;AAGxD,WAAOG,QAAP;AACD;;AAED,MAAMC,OAAO,GAAGZ,eAAe,CAACK,MAAM,CAACC,IAAR,CAA/B;;AAEA,MAAI,CAACM,OAAL,EAAc;AACZ,WAAOR,KAAP;AACD;;AAXe,gCAasBQ,OAbtB;AAAA,MAaPC,WAbO;AAAA,MAaMC,YAbN;;AAehB,MAAIC,KAAK,eAAIV,MAAD,CAAyBI,OAA5B,6CAAG,SAAkCM,KAA9C;;AAEA,MAAIA,KAAK,YAAYC,KAArB,EAA4B;AAAA;;AAC1B,QAAMC,cAAc,aAAIF,KAAJ,8DAAG,OAAuBG,QAA1B,oDAAG,gBAAiCC,IAAxD;AACAJ,IAAAA,KAAK,GACH,CAAAE,cAAc,SAAd,IAAAA,cAAc,WAAd,YAAAA,cAAc,CAAEG,OAAhB,MACAH,cADA,aACAA,cADA,uBACAA,cAAc,CAAEI,iBADhB,MAEAJ,cAFA,aAEAA,cAFA,gDAEAA,cAAc,CAAEK,MAFhB,0DAEA,sBAAyB,CAAzB,EAA4BF,OAF5B,KAGAL,KAAK,CAACK,OAJR;;AAKA,QAAI,CAAAH,cAAc,SAAd,IAAAA,cAAc,WAAd,YAAAA,cAAc,CAAEM,UAAhB,MAA+B,GAAnC,EAAwC;AACtCC,MAAAA,YAAY,CAACC,UAAb,CAAwB,UAAxB;AACA1B,MAAAA,OAAO,CAAC2B,MAAR,CAAe,WAAf;AACA3B,MAAAA,OAAO,CAAC2B,MAAR,CAAe,iBAAf;AACAC,MAAAA,MAAM,CAACC,QAAP,CAAgBC,MAAhB;AACD;AACF;;AAED,yCACKzB,KADL,2BAEGS,WAFH,EAEiBC,YAAY,KAAK,QAAjB,IAA6BC,KAA7B,GAAqCA,KAArC,GAA6C,IAF9D;AAID,CAvCD;;AAyCA,eAAeZ,YAAf","sourcesContent":["import { getType } from \"deox\";\nimport { AxiosError } from \"axios\";\nimport toastr from \"toastr\";\nimport { uiActions } from \"../../actions\";\nimport Cookies from \"js-cookie\";\n\nexport type TErrorState = { [id: string]: null | Error | string };\n\ninterface IErrorPayload {\n  error: Error | string;\n}\n\ninterface IErrorAction {\n  type: string;\n  payload?: IErrorPayload;\n}\n\ninterface IResetAction {\n  type: string;\n  payload: {\n    actionName: string;\n  };\n}\n\nconst getErrorMatches = (actionType: string) =>\n  /(.*)_(REQUEST|FAILED)/.exec(actionType);\n\nconst errorReducer = (\n  state: TErrorState = {},\n  action: IErrorAction | IResetAction\n): TErrorState => {\n  if (action.type === getType(uiActions.resetActionStatus)) {\n    const { actionName } = (action as IResetAction).payload;\n    const { [actionName]: _, ...newState } = state;\n    return newState;\n  }\n\n  const matches = getErrorMatches(action.type);\n\n  if (!matches) {\n    return state;\n  }\n\n  const [, requestName, requestState] = matches;\n\n  let error = (action as IErrorAction).payload?.error;\n\n  if (error instanceof Error) {\n    const axiosErrorData = (error as AxiosError)?.response?.data;\n    error =\n      axiosErrorData?.message ||\n      axiosErrorData?.error_description ||\n      axiosErrorData?.errors?.[0].message ||\n      error.message;\n    if (axiosErrorData?.statusCode === 401) {\n      localStorage.removeItem(\"accounts\");\n      Cookies.remove(\"crm_token\");\n      Cookies.remove(\"isAuthenticated\");\n      window.location.reload();\n    }\n  }\n\n  return {\n    ...state,\n    [requestName]: requestState === \"FAILED\" && error ? error : null,\n  };\n};\n\nexport default errorReducer;\n"]},"metadata":{},"sourceType":"module"}