{"ast":null,"code":"import _regeneratorRuntime from \"/Users/admin/Documents/personal-site/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/admin/Documents/personal-site/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/admin/Documents/personal-site/node_modules/next/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _assertThisInitialized from \"/Users/admin/Documents/personal-site/node_modules/next/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/admin/Documents/personal-site/node_modules/next/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/admin/Documents/personal-site/node_modules/next/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/admin/Documents/personal-site/node_modules/next/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"/Users/admin/Documents/personal-site/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport axios from \"axios\";\nimport HttpClient from \"../utils/axios/instance\";\nimport authHelpers from \"./helpers\";\nimport AuthInstance from \"./identity/auth\";\nimport { crmPlatform, authenticateURL, USERS_API_URL, CONFIRM_INVITE_USER } from \"./identity/index\";\nimport { catchAxiosError } from \"../utils/axios/error\";\nexport var codeStatus = {\n  SUCCESS: 200,\n  UNAUTHORIZED: 401\n};\nexport var authenticateAPI = /*#__PURE__*/function (_HttpClient) {\n  _inherits(authenticateAPI, _HttpClient);\n\n  var _super = _createSuper(authenticateAPI);\n\n  function authenticateAPI() {\n    var _this;\n\n    _classCallCheck(this, authenticateAPI);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"checkAuthenticate\", /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(payload) {\n        var response;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return axios.post(\"\".concat(authenticateURL), payload)[\"catch\"](catchAxiosError);\n\n              case 2:\n                response = _context.sent;\n                return _context.abrupt(\"return\", response);\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"checkExistedEmail\", /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email) {\n        var response;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return axios.get(\"\".concat(crmPlatform, \"/\").concat(USERS_API_URL, \"/is-email-existed/\").concat(email))[\"catch\"](catchAxiosError);\n\n              case 2:\n                response = _context2.sent;\n                return _context2.abrupt(\"return\", response);\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"confirmInviteNewUser\", /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(requestBody, token) {\n        var response;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return _this.instance.post(\"\".concat(crmPlatform, \"/\").concat(CONFIRM_INVITE_USER, \"?token=\").concat(token), requestBody)[\"catch\"](catchAxiosError);\n\n              case 2:\n                response = _context3.sent;\n                return _context3.abrupt(\"return\", response);\n\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function (_x3, _x4) {\n        return _ref3.apply(this, arguments);\n      };\n    }());\n\n    return _this;\n  }\n\n  return authenticateAPI;\n}(HttpClient);\n\nvar AuthorizedInstance = function AuthorizedInstance(baseURL) {\n  var authBearer = authHelpers.getCrmAccessToken();\n  var instance = axios.create({\n    baseURL: baseURL,\n    headers: {\n      Authorization: \"Bearer \".concat(authBearer)\n    }\n  });\n\n  var refreshTokens = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      var refreshToken, _yield$AuthInstance$r, access_token, refresh_token;\n\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return authHelpers.getRefreshToken();\n\n            case 2:\n              refreshToken = _context4.sent;\n\n              if (!refreshToken) {// navigate to login page\n              }\n\n              _context4.next = 6;\n              return AuthInstance.refreshToken(refreshToken !== null && refreshToken !== void 0 ? refreshToken : \"\");\n\n            case 6:\n              _yield$AuthInstance$r = _context4.sent;\n              access_token = _yield$AuthInstance$r.access_token;\n              refresh_token = _yield$AuthInstance$r.refresh_token;\n              authHelpers.storeAccessToken(access_token);\n              authHelpers.storeRefreshToken(refresh_token);\n              return _context4.abrupt(\"return\", authHelpers.getAccessToken());\n\n            case 12:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function refreshTokens() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var onRequest = function onRequest(request) {\n    var authBearer = authHelpers.getAccessToken();\n\n    if (authBearer) {\n      request.headers.Authorization = \"Bearer \".concat(authBearer);\n    }\n\n    return request;\n  };\n\n  var onResponseSuccess = function onResponseSuccess(response) {\n    return response;\n  };\n\n  var onResponseError = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(axiosError) {\n      var response, responseStatus, originalRequest;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              response = axiosError.response;\n              responseStatus = response === null || response === void 0 ? void 0 : response.status;\n              originalRequest = axiosError.config;\n\n              if (!(responseStatus === codeStatus.UNAUTHORIZED && originalRequest)) {\n                _context5.next = 5;\n                break;\n              }\n\n              return _context5.abrupt(\"return\", refreshTokens().then(function (newAccessToken) {\n                originalRequest.headers.Authorization = \"Bearer \".concat(newAccessToken);\n                return axios.request(originalRequest);\n              })[\"catch\"](function () {// navigate to login page\n              }));\n\n            case 5:\n              return _context5.abrupt(\"return\", Promise.reject(axiosError));\n\n            case 6:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    return function onResponseError(_x5) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  instance.interceptors.request.use(onRequest);\n  instance.interceptors.response.use(onResponseSuccess, onResponseError);\n  return instance;\n};\n\nexport default AuthorizedInstance;","map":null,"metadata":{},"sourceType":"module"}