{"ast":null,"code":"import _regeneratorRuntime from \"/Users/admin/Documents/personal-site/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/admin/Documents/personal-site/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/admin/Documents/personal-site/node_modules/next/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _assertThisInitialized from \"/Users/admin/Documents/personal-site/node_modules/next/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/admin/Documents/personal-site/node_modules/next/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/admin/Documents/personal-site/node_modules/next/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/admin/Documents/personal-site/node_modules/next/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"/Users/admin/Documents/personal-site/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport axios from \"axios\";\nimport HttpClient from \"../utils/axios/instance\";\nimport authHelpers from \"./helpers\";\nimport AuthInstance from \"./identity/auth\";\nimport { crmPlatform, authenticateURL, USERS_API_URL, CONFIRM_INVITE_USER } from \"./identity/index\";\nimport { catchAxiosError } from \"../utils/axios/error\";\nexport var codeStatus = {\n  SUCCESS: 200,\n  UNAUTHORIZED: 401\n};\nexport var authenticateAPI = /*#__PURE__*/function (_HttpClient) {\n  _inherits(authenticateAPI, _HttpClient);\n\n  var _super = _createSuper(authenticateAPI);\n\n  function authenticateAPI() {\n    var _this;\n\n    _classCallCheck(this, authenticateAPI);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"checkAuthenticate\", /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(payload) {\n        var response;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return axios.post(\"\".concat(authenticateURL), payload)[\"catch\"](catchAxiosError);\n\n              case 2:\n                response = _context.sent;\n                return _context.abrupt(\"return\", response);\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"checkExistedEmail\", /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email) {\n        var response;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return axios.get(\"\".concat(crmPlatform, \"/\").concat(USERS_API_URL, \"/is-email-existed/\").concat(email))[\"catch\"](catchAxiosError);\n\n              case 2:\n                response = _context2.sent;\n                return _context2.abrupt(\"return\", response);\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"confirmInviteNewUser\", /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(requestBody, token) {\n        var response;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return _this.instance.post(\"\".concat(crmPlatform, \"/\").concat(CONFIRM_INVITE_USER, \"?token=\").concat(token), requestBody)[\"catch\"](catchAxiosError);\n\n              case 2:\n                response = _context3.sent;\n                return _context3.abrupt(\"return\", response);\n\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function (_x3, _x4) {\n        return _ref3.apply(this, arguments);\n      };\n    }());\n\n    return _this;\n  }\n\n  return authenticateAPI;\n}(HttpClient);\n\nvar AuthorizedInstance = function AuthorizedInstance(baseURL) {\n  var authBearer = authHelpers.getCrmAccessToken();\n  var instance = axios.create({\n    baseURL: baseURL,\n    headers: {\n      Authorization: \"Bearer \".concat(authBearer)\n    }\n  });\n\n  var refreshTokens = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      var refreshToken, _yield$AuthInstance$r, access_token, refresh_token;\n\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return authHelpers.getRefreshToken();\n\n            case 2:\n              refreshToken = _context4.sent;\n\n              if (!refreshToken) {// navigate to login page\n              }\n\n              _context4.next = 6;\n              return AuthInstance.refreshToken(refreshToken !== null && refreshToken !== void 0 ? refreshToken : \"\");\n\n            case 6:\n              _yield$AuthInstance$r = _context4.sent;\n              access_token = _yield$AuthInstance$r.access_token;\n              refresh_token = _yield$AuthInstance$r.refresh_token;\n              authHelpers.storeAccessToken(access_token);\n              authHelpers.storeRefreshToken(refresh_token);\n              return _context4.abrupt(\"return\", authHelpers.getAccessToken());\n\n            case 12:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function refreshTokens() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var onRequest = function onRequest(request) {\n    var authBearer = authHelpers.getAccessToken();\n\n    if (authBearer) {\n      request.headers.Authorization = \"Bearer \".concat(authBearer);\n    }\n\n    return request;\n  };\n\n  var onResponseSuccess = function onResponseSuccess(response) {\n    return response;\n  };\n\n  var onResponseError = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(axiosError) {\n      var response, responseStatus, originalRequest;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              response = axiosError.response;\n              responseStatus = response === null || response === void 0 ? void 0 : response.status;\n              originalRequest = axiosError.config;\n\n              if (!(responseStatus === codeStatus.UNAUTHORIZED && originalRequest)) {\n                _context5.next = 5;\n                break;\n              }\n\n              return _context5.abrupt(\"return\", refreshTokens().then(function (newAccessToken) {\n                originalRequest.headers.Authorization = \"Bearer \".concat(newAccessToken);\n                return axios.request(originalRequest);\n              })[\"catch\"](function () {// navigate to login page\n              }));\n\n            case 5:\n              return _context5.abrupt(\"return\", Promise.reject(axiosError));\n\n            case 6:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    return function onResponseError(_x5) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  instance.interceptors.request.use(onRequest);\n  instance.interceptors.response.use(onResponseSuccess, onResponseError);\n  return instance;\n};\n\n_c = AuthorizedInstance;\nexport default AuthorizedInstance;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthorizedInstance\");","map":{"version":3,"sources":["/Users/admin/Documents/personal-site/src/services/authorized-api.ts"],"names":["axios","HttpClient","authHelpers","AuthInstance","crmPlatform","authenticateURL","USERS_API_URL","CONFIRM_INVITE_USER","catchAxiosError","codeStatus","SUCCESS","UNAUTHORIZED","authenticateAPI","payload","post","response","email","get","requestBody","token","instance","AuthorizedInstance","baseURL","authBearer","getCrmAccessToken","create","headers","Authorization","refreshTokens","getRefreshToken","refreshToken","access_token","refresh_token","storeAccessToken","storeRefreshToken","getAccessToken","onRequest","request","onResponseSuccess","onResponseError","axiosError","responseStatus","status","originalRequest","config","then","newAccessToken","Promise","reject","interceptors","use"],"mappings":"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","sourcesContent":["import axios, {\n  AxiosRequestConfig,\n  AxiosResponse,\n  AxiosError,\n  AxiosInstance,\n} from \"axios\";\nimport HttpClient from \"../utils/axios/instance\";\nimport { IResponse, IConfig } from \"../utils/axios/entities\";\nimport authHelpers from \"./helpers\";\nimport AuthInstance from \"./identity/auth\";\nimport { crmPlatform, authenticateURL, USERS_API_URL, CONFIRM_INVITE_USER } from \"./identity/index\";\n\nimport { catchAxiosError } from \"../utils/axios/error\";\n\nexport const codeStatus = {\n  SUCCESS: 200,\n  UNAUTHORIZED: 401,\n};\n\nexport class authenticateAPI extends HttpClient {\n  public checkAuthenticate = async (payload: any): Promise<IResponse> => {\n    const response: IResponse = await axios.post(`${authenticateURL}`, payload).catch(catchAxiosError);\n    return response;\n  };\n\n  public checkExistedEmail = async (email: string): Promise<IResponse> => {\n    const response: IResponse = await axios.get(`${crmPlatform}/${USERS_API_URL}/is-email-existed/${email}`).catch(catchAxiosError);\n    return response;\n  };\n\n  public confirmInviteNewUser = async (requestBody: any, token: string): Promise<IResponse> => {\n    const response: IResponse = await this.instance.post(`${crmPlatform}/${CONFIRM_INVITE_USER}?token=${token}`, requestBody).catch(catchAxiosError);\n    return response;\n  };\n}\n\n\n\nconst AuthorizedInstance = (baseURL: string): AxiosInstance => {\n  const authBearer = authHelpers.getCrmAccessToken();\n  const instance = axios.create({\n    baseURL,\n    headers: {\n      Authorization: `Bearer ${authBearer}`,\n    },\n  });\n\n  const refreshTokens = async () => {\n    const refreshToken = await authHelpers.getRefreshToken();\n\n    if (!refreshToken) {\n      // navigate to login page\n    }\n\n    const { access_token, refresh_token } = await AuthInstance.refreshToken(\n      refreshToken ?? \"\"\n    );\n\n    authHelpers.storeAccessToken(access_token);\n    authHelpers.storeRefreshToken(refresh_token);\n\n    return authHelpers.getAccessToken();\n  };\n\n  const onRequest = (request: AxiosRequestConfig) => {\n    const authBearer = authHelpers.getAccessToken();\n    if (authBearer) {\n      request.headers.Authorization = `Bearer ${authBearer}`;\n    }\n\n    return request;\n  };\n\n  const onResponseSuccess = (response: AxiosResponse) => response;\n\n  const onResponseError = async (axiosError: AxiosError) => {\n    const { response } = axiosError;\n    const responseStatus = response?.status;\n    const originalRequest = axiosError.config;\n\n    if (responseStatus === codeStatus.UNAUTHORIZED && originalRequest) {\n      return refreshTokens()\n        .then((newAccessToken) => {\n          originalRequest.headers.Authorization = `Bearer ${newAccessToken}`;\n          return axios.request(originalRequest);\n        })\n        .catch(() => {\n          // navigate to login page\n        });\n    }\n\n    return Promise.reject(axiosError);\n  };\n\n  instance.interceptors.request.use(onRequest);\n  instance.interceptors.response.use(onResponseSuccess, onResponseError);\n\n  return instance;\n};\n\nexport default AuthorizedInstance;\n"]},"metadata":{},"sourceType":"module"}