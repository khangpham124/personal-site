{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\n\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\nimport { getType } from \"deox\";\nimport { uiActions } from \"../../actions\";\nimport Cookies from \"js-cookie\";\n\nconst getErrorMatches = actionType => /(.*)_(REQUEST|FAILED)/.exec(actionType);\n\nconst errorReducer = (state = {}, action) => {\n  var _payload;\n\n  if (action.type === getType(uiActions.resetActionStatus)) {\n    const {\n      actionName\n    } = action.payload;\n\n    const {\n      [actionName]: _\n    } = state,\n          newState = _objectWithoutProperties(state, [actionName].map(_toPropertyKey));\n\n    return newState;\n  }\n\n  const matches = getErrorMatches(action.type);\n\n  if (!matches) {\n    return state;\n  }\n\n  const [, requestName, requestState] = matches;\n  let error = (_payload = action.payload) === null || _payload === void 0 ? void 0 : _payload.error;\n\n  if (error instanceof Error) {\n    var _error, _error$response, _axiosErrorData$error;\n\n    const axiosErrorData = (_error = error) === null || _error === void 0 ? void 0 : (_error$response = _error.response) === null || _error$response === void 0 ? void 0 : _error$response.data;\n    error = (axiosErrorData === null || axiosErrorData === void 0 ? void 0 : axiosErrorData.message) || (axiosErrorData === null || axiosErrorData === void 0 ? void 0 : axiosErrorData.error_description) || (axiosErrorData === null || axiosErrorData === void 0 ? void 0 : (_axiosErrorData$error = axiosErrorData.errors) === null || _axiosErrorData$error === void 0 ? void 0 : _axiosErrorData$error[0].message) || error.message;\n\n    if ((axiosErrorData === null || axiosErrorData === void 0 ? void 0 : axiosErrorData.statusCode) === 401) {\n      localStorage.removeItem(\"accounts\");\n      Cookies.remove(\"crm_token\");\n      Cookies.remove(\"isAuthenticated\");\n      window.location.reload();\n    }\n  }\n\n  return _objectSpread(_objectSpread({}, state), {}, {\n    [requestName]: requestState === \"FAILED\" && error ? error : null\n  });\n};\n\nexport default errorReducer;","map":{"version":3,"sources":["/Users/admin/Documents/personal-site/src/state-management/reducers/status/error.ts"],"names":["getType","uiActions","Cookies","getErrorMatches","actionType","exec","errorReducer","state","action","type","resetActionStatus","actionName","payload","_","newState","matches","requestName","requestState","error","Error","axiosErrorData","response","data","message","error_description","errors","statusCode","localStorage","removeItem","remove","window","location","reload"],"mappings":";;;;;;;;;;;;;;AAAA,SAASA,OAAT,QAAwB,MAAxB;AAGA,SAASC,SAAT,QAA0B,eAA1B;AACA,OAAOC,OAAP,MAAoB,WAApB;;AAoBA,MAAMC,eAAe,GAAIC,UAAD,IACtB,wBAAwBC,IAAxB,CAA6BD,UAA7B,CADF;;AAGA,MAAME,YAAY,GAAG,CACnBC,KAAkB,GAAG,EADF,EAEnBC,MAFmB,KAGH;AAAA;;AAChB,MAAIA,MAAM,CAACC,IAAP,KAAgBT,OAAO,CAACC,SAAS,CAACS,iBAAX,CAA3B,EAA0D;AACxD,UAAM;AAAEC,MAAAA;AAAF,QAAkBH,MAAD,CAAyBI,OAAhD;;AACA,UAAM;AAAE,OAACD,UAAD,GAAcE;AAAhB,QAAmCN,KAAzC;AAAA,UAA4BO,QAA5B,4BAAyCP,KAAzC,GAASI,UAAT;;AACA,WAAOG,QAAP;AACD;;AAED,QAAMC,OAAO,GAAGZ,eAAe,CAACK,MAAM,CAACC,IAAR,CAA/B;;AAEA,MAAI,CAACM,OAAL,EAAc;AACZ,WAAOR,KAAP;AACD;;AAED,QAAM,GAAGS,WAAH,EAAgBC,YAAhB,IAAgCF,OAAtC;AAEA,MAAIG,KAAK,eAAIV,MAAD,CAAyBI,OAA5B,6CAAG,SAAkCM,KAA9C;;AAEA,MAAIA,KAAK,YAAYC,KAArB,EAA4B;AAAA;;AAC1B,UAAMC,cAAc,aAAIF,KAAJ,8DAAG,OAAuBG,QAA1B,oDAAG,gBAAiCC,IAAxD;AACAJ,IAAAA,KAAK,GACH,CAAAE,cAAc,SAAd,IAAAA,cAAc,WAAd,YAAAA,cAAc,CAAEG,OAAhB,MACAH,cADA,aACAA,cADA,uBACAA,cAAc,CAAEI,iBADhB,MAEAJ,cAFA,aAEAA,cAFA,gDAEAA,cAAc,CAAEK,MAFhB,0DAEA,sBAAyB,CAAzB,EAA4BF,OAF5B,KAGAL,KAAK,CAACK,OAJR;;AAKA,QAAI,CAAAH,cAAc,SAAd,IAAAA,cAAc,WAAd,YAAAA,cAAc,CAAEM,UAAhB,MAA+B,GAAnC,EAAwC;AACtCC,MAAAA,YAAY,CAACC,UAAb,CAAwB,UAAxB;AACA1B,MAAAA,OAAO,CAAC2B,MAAR,CAAe,WAAf;AACA3B,MAAAA,OAAO,CAAC2B,MAAR,CAAe,iBAAf;AACAC,MAAAA,MAAM,CAACC,QAAP,CAAgBC,MAAhB;AACD;AACF;;AAED,yCACKzB,KADL;AAEE,KAACS,WAAD,GAAeC,YAAY,KAAK,QAAjB,IAA6BC,KAA7B,GAAqCA,KAArC,GAA6C;AAF9D;AAID,CAvCD;;AAyCA,eAAeZ,YAAf","sourcesContent":["import { getType } from \"deox\";\nimport { AxiosError } from \"axios\";\nimport toastr from \"toastr\";\nimport { uiActions } from \"../../actions\";\nimport Cookies from \"js-cookie\";\n\nexport type TErrorState = { [id: string]: null | Error | string };\n\ninterface IErrorPayload {\n  error: Error | string;\n}\n\ninterface IErrorAction {\n  type: string;\n  payload?: IErrorPayload;\n}\n\ninterface IResetAction {\n  type: string;\n  payload: {\n    actionName: string;\n  };\n}\n\nconst getErrorMatches = (actionType: string) =>\n  /(.*)_(REQUEST|FAILED)/.exec(actionType);\n\nconst errorReducer = (\n  state: TErrorState = {},\n  action: IErrorAction | IResetAction\n): TErrorState => {\n  if (action.type === getType(uiActions.resetActionStatus)) {\n    const { actionName } = (action as IResetAction).payload;\n    const { [actionName]: _, ...newState } = state;\n    return newState;\n  }\n\n  const matches = getErrorMatches(action.type);\n\n  if (!matches) {\n    return state;\n  }\n\n  const [, requestName, requestState] = matches;\n\n  let error = (action as IErrorAction).payload?.error;\n\n  if (error instanceof Error) {\n    const axiosErrorData = (error as AxiosError)?.response?.data;\n    error =\n      axiosErrorData?.message ||\n      axiosErrorData?.error_description ||\n      axiosErrorData?.errors?.[0].message ||\n      error.message;\n    if (axiosErrorData?.statusCode === 401) {\n      localStorage.removeItem(\"accounts\");\n      Cookies.remove(\"crm_token\");\n      Cookies.remove(\"isAuthenticated\");\n      window.location.reload();\n    }\n  }\n\n  return {\n    ...state,\n    [requestName]: requestState === \"FAILED\" && error ? error : null,\n  };\n};\n\nexport default errorReducer;\n"]},"metadata":{},"sourceType":"module"}